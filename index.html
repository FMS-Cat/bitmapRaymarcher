<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
      *
      {
        background : #000;
      }
		</style>
	</head>
	<body>
    <script src="ItaPoly.js"></script>
	  <script src="distanceTexture.js"></script>
		<script>
			function requestText( _url, _callback ){
				var xhr = new XMLHttpRequest();
				xhr.open( 'GET', _url, true );
				xhr.responseType = 'text';
				xhr.onload = function( _e ){
					_callback( this.response );
				};
				xhr.send();
			}

			var bitmap = null;
      var img = new Image();
      img.onload = function(){
        createDistanceTexture( img, 512, 512, function( _texture ){
					bitmap = _texture;
				} );
      };
      img.src = 'a.png';

      var width = 512;
      var height = 512;
			var itaPolyMarch = new ItaPoly( width, height );
			document.body.appendChild( itaPolyMarch.canvas );

			requestText( 'raymarch.frag', function( _text ){
				itaPolyMarch.createProgram( _text, function(){
					function update(){
						itaPolyMarch.setSampler2D( 'texture', bitmap );
						itaPolyMarch.update();
						requestAnimationFrame( update );
					}
					update();
				} );
			} );
		</script>
	</body>
</html>
